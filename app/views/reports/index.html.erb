<%= render 'projects/left_sidebar' %>
<%= render 'dashboard/tabs' %>

<div class="container-fluid">
  <%= form_with url: project_reports_path, class: 'reports-form' do |f| %>
    <br>

    <div id="projects-dropdown" class="display-inline">
      <%= f.select :select_on_projects, options_from_collection_for_select(@projects, "id", "title"), {}, { multiple: true } %>
    </div>

    <div id="employees-dropdown" class="display-inline">
      <%= f.select :select_on_employees, options_from_collection_for_select(@employees, "id", "full_name"), {}, { multiple: true } %>
    </div>

    <div>
      <br><%= f.submit "Generate Reports" %>
    </div>
  <% end %>

  <% puts "hello" %>
  <% puts @tickets_priority_piechart %>
  <%= pie_chart @tickets_priority_piechart, donut: true, width: "1000px" %>

  <div id="piechart_div"></div>

</div>

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript">
    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
      var data = new google.visualization.DataTable();
      data.addColumn('string', 'Priority');
      data.addColumn('number', 'Tickets');
      data.addRows([
        ['High', <%= @nr_of_high_priority_tickets %>],
        ['Medium', <%= @nr_of_medium_priority_tickets %>],
        ['Low', <%= @nr_of_low_priority_tickets %>],
      ]);

      var options = {'title':'Tasks by priority',
                     'width':400,
                     'height':300};

      var chart = new google.visualization.PieChart(document.getElementById('piechart_div'));
      chart.draw(data, options);
    }

  </script>
