<%= render 'projects/left_sidebar' %>
<%= render 'dashboard/tabs' %>

<div class="container-fluid">
  <%= form_with url: project_reports_path, class: 'reports-form' do |f| %>
    <br>

    <div class="form-group col-sm-7">
      <div id="projects-dropdown" class="display-inline">
        <%= f.select :select_on_projects, options_from_collection_for_select(@projects, "id", "title"), {}, { multiple: true } %>
      </div>

      <div id="employees-dropdown" class="display-inline">
        <%= f.select :select_on_employees, options_from_collection_for_select(@employees, "id", "full_name"), {}, { multiple: true } %>
      </div>

      <div id="tickets-dropdown" class="display-inline">
        <%= f.select :select_on_tickets, options_for_select(["Tasks", "Bugs"]), {}, { multiple: true } %>
      </div>

      <div id="tickets-status-dropdown" class="display-inline">
        <%= f.select :select_on_tickets_status, options_for_select(["TO DO", "In progress", "Complete", "Done"]), {}, { multiple: true } %>
      </div>
    </div>

    <div class="form-group col-sm-4">
      <div class='report-datetimepicker-wrapper input-group'>
        <div class="input-group-addon">
          <span class="input-group-text">From</span>
        </div>
        <%= f.text_field :report_from_date, autocomplete: 'off', class: 'form-control', id: 'report-from-datetimepicker' %>
        <span class="input-group-addon">
          <span class="glyphicon glyphicon-calendar"></span>
        </span>

        <div class="input-group-addon">
          <span class="input-group-text">To</span>
        </div>
        <%= f.text_field :report_to_date, autocomplete: 'off', class: 'form-control', id: 'report-to-datetimepicker' %>
        <span class="input-group-addon">
          <span class="glyphicon glyphicon-calendar"></span>
        </span>
      </div>
    </div>

    <div class="form group col-sm-1">
      <%= f.submit "Generate Reports" %>
    </div>
  <% end %>

  <% puts "hello" %>
  <% puts @tickets_priority_piechart %>
  <%= pie_chart @tickets_priority_piechart, donut: true, width: "1000px" %>

  <div class="piechart_div"><div>

</div>

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript">
    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
      var data = new google.visualization.DataTable();
      data.addColumn('string', 'Priority');
      data.addColumn('number', 'Tickets');
      data.addRows([
        ['High', <%= @nr_of_high_priority_tickets %>],
        ['Medium', <%= @nr_of_medium_priority_tickets %>],
        ['Low', <%= @nr_of_low_priority_tickets %>],
      ]);

      var options = {'title':'Tasks by priority',
                     'width':400,
                     'height':300};

      var chart = new google.visualization.PieChart(document.getElementById('piechart_div'));
      chart.draw(data, options);
    }

  </script>
